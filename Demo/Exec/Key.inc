;
; Exec/Key.inc
;

; This module installs a Keyboard interrupt handler. There's not much to do:
; the defaults as set by the Boot ROM are good enough.
; Of course, to be a true Device Driver, something needs to convert the KeyCodes
; generated by the keyboard into the ASCII equivalents (or whatever) for more
; general consumption by other programs. This has been left as an exercise for
; the reader - until I get impatient and do it myself...

Exec.Key:
; First, install a Keyboard interrupt handler
                MOV             EAX, Ints.Key      ; Handler
                MOV             BX,  Demo.IDT.Key  ; Interrupt
                MOV             CX,  x86.Selector(Demo.GDT.Ints, .GDT, .RPL0)
                MOV             DL,  x86.Type.Sys(.Int, .DPL0, .386)
                CALL            Exec.Alloc.IDT

; Finally, enable the Keyboard interrupt in the PIC
                Dev.PIC.Enable  .A.Key             ; Unmask Key IRQ

                IN              AL, Kbd.Data       ; Acknowledge any pending interrupt
                RET
